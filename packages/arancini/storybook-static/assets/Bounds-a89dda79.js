import{_ as j}from"./extends-98964cd2.js";import{r}from"./index-76fb7be0.js";import{a as P,W as A,L as k,H as D,e as V,F as q,u as I,V as f,B as G,f as C}from"./react-three-fiber.esm-dca5276d.js";function U(i){return function(l){i.forEach(function(y){typeof y=="function"?y(l):y!=null&&(y.current=l)})}}function J(i,l,y){const b=P(z=>z.size),w=P(z=>z.viewport),h=typeof i=="number"?i:b.width*w.dpr,g=typeof l=="number"?l:b.height*w.dpr,F=(typeof i=="number"?y:i)||{},{samples:M=0,depth:e,...p}=F,d=r.useMemo(()=>{const z=new A(h,g,{minFilter:k,magFilter:k,type:D,...p});return e&&(z.depthTexture=new V(h,g,q)),z.samples=M,z},[]);return r.useLayoutEffect(()=>{d.setSize(h,g),M&&(d.samples=M)},[M,d,h,g]),r.useEffect(()=>()=>d.dispose(),[]),d}const K=i=>typeof i=="function",$=r.forwardRef(({envMap:i,resolution:l=256,frames:y=1/0,makeDefault:b,children:w,...h},g)=>{const F=P(({set:u})=>u),M=P(({camera:u})=>u),e=P(({size:u})=>u),p=r.useRef(null),d=r.useRef(null),z=J(l);r.useLayoutEffect(()=>{h.manual||(p.current.aspect=e.width/e.height)},[e,h]),r.useLayoutEffect(()=>{p.current.updateProjectionMatrix()});let o=0,R=null;const S=K(w);return I(u=>{S&&(y===1/0||o<y)&&(d.current.visible=!1,u.gl.setRenderTarget(z),R=u.scene.background,i&&(u.scene.background=i),u.gl.render(u.scene,p.current),u.scene.background=R,u.gl.setRenderTarget(null),d.current.visible=!0,o++)}),r.useLayoutEffect(()=>{if(b){const u=M;return F(()=>({camera:p.current})),()=>F(()=>({camera:u}))}},[p,b,F]),r.createElement(r.Fragment,null,r.createElement("perspectiveCamera",j({ref:U([p,g])},h),!S&&w),r.createElement("group",{ref:d},S&&w(z.texture)))}),L=i=>i&&i.isOrthographicCamera,N=i=>i&&i.isBox3,Q=r.createContext(null);function ee({children:i,damping:l=6,fit:y,clip:b,observe:w,margin:h=1.2,eps:g=.01,onFit:F}){const M=r.useRef(null),{camera:e,invalidate:p,size:d,controls:z}=P(),o=z,R=r.useRef(F);R.current=F;function S(s,t){return Math.abs(s.x-t.x)<g&&Math.abs(s.y-t.y)<g&&Math.abs(s.z-t.z)<g}function u(s,t,c,x){s.x=C.damp(s.x,t.x,c,x),s.y=C.damp(s.y,t.y,c,x),s.z=C.damp(s.z,t.z,c,x)}const[a]=r.useState(()=>({animating:!1,focus:new f,camera:new f,zoom:1})),[m]=r.useState(()=>({focus:new f,camera:new f,zoom:1})),[n]=r.useState(()=>new G),T=r.useMemo(()=>{function s(){const t=n.getSize(new f),c=n.getCenter(new f),x=Math.max(t.x,t.y,t.z),E=L(e)?x*4:x/(2*Math.atan(Math.PI*e.fov/360)),v=L(e)?x*4:E/e.aspect,W=h*Math.max(E,v);return{box:n,size:t,center:c,distance:W}}return{getSize:s,refresh(t){if(N(t))n.copy(t);else{const c=t||M.current;if(!c)return this;c.updateWorldMatrix(!0,!0),n.setFromObject(c)}if(n.isEmpty()){const c=e.position.length()||10;n.setFromCenterAndSize(new f,new f(c,c,c))}if((o==null?void 0:o.constructor.name)==="OrthographicTrackballControls"){const{distance:c}=s(),x=e.position.clone().sub(o.target).normalize().multiplyScalar(c),E=o.target.clone().add(x);e.position.copy(E)}return this},clip(){const{distance:t}=s();return o&&(o.maxDistance=t*10),e.near=t/100,e.far=t*100,e.updateProjectionMatrix(),o&&o.update(),p(),this},to({position:t,target:c}){a.camera.copy(e.position);const{center:x}=s();return m.camera.set(...t),c?m.focus.set(...c):m.focus.copy(x),l?a.animating=!0:e.position.set(...t),this},fit(){a.camera.copy(e.position),o&&a.focus.copy(o.target);const{center:t,distance:c}=s(),x=t.clone().sub(e.position).normalize().multiplyScalar(c);if(m.camera.copy(t).sub(x),m.focus.copy(t),L(e)){a.zoom=e.zoom;let E=0,v=0;const W=[new f(n.min.x,n.min.y,n.min.z),new f(n.min.x,n.max.y,n.min.z),new f(n.min.x,n.min.y,n.max.z),new f(n.min.x,n.max.y,n.max.z),new f(n.max.x,n.max.y,n.max.z),new f(n.max.x,n.max.y,n.min.z),new f(n.max.x,n.min.y,n.max.z),new f(n.max.x,n.min.y,n.min.z)];t.applyMatrix4(e.matrixWorldInverse);for(const B of W)B.applyMatrix4(e.matrixWorldInverse),E=Math.max(E,Math.abs(B.y-t.y)),v=Math.max(v,Math.abs(B.x-t.x));E*=2,v*=2;const O=(e.top-e.bottom)/E,_=(e.right-e.left)/v;m.zoom=Math.min(O,_)/h,l||(e.zoom=m.zoom,e.updateProjectionMatrix())}return l?a.animating=!0:(e.position.copy(m.camera),e.lookAt(m.focus),o&&(o.target.copy(m.focus),o.update())),R.current&&R.current(this.getSize()),p(),this}}},[n,e,o,h,l,p]);r.useLayoutEffect(()=>{if(o){const s=()=>a.animating=!1;return o.addEventListener("start",s),()=>o.removeEventListener("start",s)}},[o]);const H=r.useRef(0);return r.useLayoutEffect(()=>{(w||H.current++===0)&&(T.refresh(),y&&T.fit(),b&&T.clip())},[d,b,y,w,e,o]),I((s,t)=>{if(a.animating){if(u(a.focus,m.focus,l,t),u(a.camera,m.camera,l,t),a.zoom=C.damp(a.zoom,m.zoom,l,t),e.position.copy(a.camera),L(e)&&(e.zoom=a.zoom,e.updateProjectionMatrix()),o?(o.target.copy(a.focus),o.update()):e.lookAt(a.focus),p(),L(e)&&!(Math.abs(a.zoom-m.zoom)<g)||!L(e)&&!S(a.camera,m.camera)||o&&!S(a.focus,m.focus))return;a.animating=!1}}),r.createElement("group",{ref:M},r.createElement(Q.Provider,{value:T},i))}export{ee as B,$ as P};
